webpackJsonp([2],{"61cz":function(t,e){},AyHE:function(t,e,i){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var o={data:function(){return{}},computed:{token:function(){return""}},methods:{_getSplitData:function(t){return t?t.split(","):[]},_downLoadFile:function(t){var e=this,i=t.url;t.response&&t.response.data&&(i=t.response.data.url),this.$http.get("ucenterGh/file/download",{filePath:i},{responseType:"arraybuffer"}).then(function(i){e.$downloadFile(i,t.name||t.fileName)})},_setFieldItem:function(t,e,i,a,o){"edit"===i&&"el-upload"===t.tag&&(t.action=this.$http.makeUrl("ucenterGh/file/upload"),t.headers={token:this.token},t["on-preview"]=this._downLoadFile),t.defaultValue=e[t.formId]||"",0===a[o]&&(t.hidden=!0),1===a[o]&&(t.disabled=!0)},_formatLayout:function(t,e,i){var o=this,r={},n={},s=[];if(e){(s=e.approvalModuleInstanceList||e.approvalModuleInstanceEntitieList||[]).sort(function(t,e){return t.moduleOrder-e.moduleOrder}),s.forEach(function(t){r[parseInt(t.moduleKey)]=t.moduleVal,"el-upload"===t.tag?t.fileJson&&(r[parseInt(t.moduleKey)]=JSON.parse(t.fileJson)):("fc-date-duration"===t.tag||"el-select"===t.tag&&0===t.multiple)&&(r[parseInt(t.moduleKey)]=o._getSplitData(t.moduleVal))});var l=e.positionInfo||{};JSON.parse(l.ifModulesEdit||"[]").forEach(function(t){n[t.formId]=t.formOperate}),t.approvalBusinessEntity=e.approvalBusinessEntity}var c,u,p=t.approvalFormEntityList||[],d=[];return console.log(r),p.forEach(function(t){if(t.moduleContext){var e=function(){var e=JSON.parse(t.moduleContext);if(o._setFieldItem(e,r,i,n,e.formId),e.children&&e.children.length>0&&e.children.forEach(function(t){o._setFieldItem(t,r,i,n,e.formId)}),d.push(e),e.listComponent)for(var a=1;a<100;a++){var s=e.formId+1e5+100*a+1;if(void 0===r[s])return{v:void 0};var l=JSON.parse(JSON.stringify(e));o._createNewAccount(l,a),o._setFieldItem(l,r,i,n,e.formId),l.children&&l.children.length>0&&l.children.forEach(function(t){o._setFieldItem(t,r,i,n,e.formId)}),l.rawFormId=e.formId,d.push(l)}}();if("object"===(void 0===e?"undefined":a(e)))return e.v}}),t.fields=d,u={fields:[],formRef:"elForm",formModel:"formData",size:"small",labelPosition:"right",labelWidth:100,formRules:"rules",gutter:15,disabled:!1,span:12,formBtns:!0},(c=t)&&(u=Object.assign(u,c)),u},_createNewAccount:function(t,e){var i=this;t.formId=t.formId+1e5+100*e,t.renderKey=t.formId+(new Date).getTime(),t.vModel="field"+t.formId,t.componentName&&(t.componentName="row"+t.formId),t.children&&t.children.length>0&&t.children.forEach(function(t){i._createNewAccount(t,e)})},_setApprovalFormModuleAddFormItem:function(t,e,i){var o=t[e.vModel],r=1,n="";if("el-upload"===e.tag){var s=[];(t[e.vModel]||[]).forEach(function(t){var e=t;t.response&&t.response.data&&(e=t.response.data),s.push({url:e.url,fileDwg:e.fileDwg,fileSize:e.fileSize,name:e.name})}),o="",n=JSON.stringify(s),delete e.action,delete e.headers,delete e.defaultValue}else"object"===(void 0===o?"undefined":a(o))&&(o=t[e.vModel].join(","),"el-select"===e.tag&&(r=0));return{moduleContext:JSON.stringify(e),moduleKey:e.formId,moduleOrder:i,moduleVal:o,multiple:r,tag:e.tag,fileJson:n,orgCode:this.$commonQueryParam.orgCode,orgId:this.$commonQueryParam.orgId}},_getApprovalFormModuleAddFormList:function(t,e){var i=this,a=[];(t.fields||[]).forEach(function(t,o){t.children&&t.children.length>0?t.children.forEach(function(t,r){a.push(i._setApprovalFormModuleAddFormItem(e,t,100*o+r))}):a.push(i._setApprovalFormModuleAddFormItem(e,t,o))});var o=0;return a.forEach(function(t){"fc-amount"===t.tag&&(o+=parseFloat(t.moduleVal||0)||0)}),{money:o,approvalFormModuleAddFormList:a}},_createModelForm:function(t){var e={};return t.forEach(function(t){"rowFormItem"===t.layout?t.children&&t.children.length&&t.children.forEach(function(t){e[t.vModel]=t.defaultValue}):e[t.vModel]=t.defaultValue}),e}}},r=i("tHn/"),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],a=!0,o=!1,r=void 0;try{for(var n,s=t[Symbol.iterator]();!(a=(n=s.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){o=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l={name:"FormItemView",components:{FileView:r.a},props:{detail:{type:Object,default:function(){return{}}},modelForm:{type:Object,default:function(){return{}}}},data:function(){return{value:"",show:!1,accountList:[]}},watch:{detail:function(){this.initDetail()}},created:function(){this.initDetail()},deactivated:function(){this.show=!1},methods:{open:function(t){this.accountList=t,this.show=!0},backHandler:function(){this.$router.history.go(-1)},formatAccountNo:function(t){return(t=""+t).substr(0,4)+"****"+t.substr(-4,4)},close:function(){this.show=!1,this.$emit("close")},initDetail:function(){},getAmountChinese:function(t){var e=+t;if(Number.isNaN(e)||e<0)return"";var i=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],a=["","拾","佰","仟"],o=["","万","亿"],r=["角","分","厘","毫"],n=e.toString().split("."),l=s(n,2),c=l[0],u=l[1];if(c&&c.length>12)return"金额过大无法计算";var p="";if(c)for(var d=0,f=c.length;d<f;d++){var h=c.charAt(d),v=f-d-1;if("0"===h){if(d===f-1){1===c.length&&(p+="零");break}if("0"===c.charAt(d+1))continue}p+=i[h],parseInt(h)&&(p+=a[v%4]),v%4==0&&(p+=o[Math.floor(v/4)])}if(p+="圆",parseInt(u))for(var m=0;m<4;m++){var g=u.charAt(m);parseInt(g)&&(p+=i[g]+r[m])}else p+="整";return p},formatSelectValue:function(t){return"object"===(void 0===t?"undefined":n(t))?t.join(" ， "):t},downLoadFile:function(t){var e=this;this.$http.get("ucenter/file/download",{filePath:t.url},{responseType:"arraybuffer"}).then(function(i){e.$downloadFile(i,t.name||t.fileName)})},toApprovalSteps:function(){this.$router.push({name:"ApprovalSteps",query:{name:"审批详情"}})},viewFile:function(t){var e=[];(t=t||[]).forEach(function(t){e.push({name:t.name,url:t.url})}),this.$refs.fileView.open(e)}}},c=i("W5g0");var u=function(t){i("TahT")},p=Object(c.a)(l,function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.detail.hidden?t._e():i("div",["el-input"===t.detail.tag?[i("van-cell",{attrs:{title:t.detail.label}},[t._v(t._s(t.detail.defaultValue))])]:t._e(),t._v(" "),"h3"===t.detail.tag?[i("div",{staticClass:"col-title"},[i("div",{staticClass:"col-title-content"},[t._v(t._s(t.detail.childText))])])]:t._e(),t._v(" "),"el-divider"===t.detail.tag?[i("van-divider")]:t._e(),t._v(" "),"a"===t.detail.tag?[i("van-cell",{attrs:{title:t.detail.label}},[i("a",{staticClass:"theme-text",attrs:{href:t.detail.href}},[t._v(t._s(t.detail.jump?t.detail.childText:t.detail.href))])])]:t._e(),t._v(" "),"fc-amount"===t.detail.tag?[i("van-cell",{attrs:{title:t.detail.label}},[t._v(t._s(t.$formatMoney(t.detail.defaultValue)))]),t._v(" "),i("div",{staticClass:"explain-text"},[t._v("大写："+t._s(t.getAmountChinese(t.modelForm[t.detail.vModel])))])]:t._e(),t._v(" "),"fc-date-duration"===t.detail.tag?[i("van-cell",{attrs:{title:t.detail.label}},[t._v(t._s(t.detail.defaultValue&&t.detail.defaultValue.join(" - ")))])]:t._e(),t._v(" "),"el-select"===t.detail.tag?[i("van-cell",{attrs:{title:t.detail.label}},[t._v(t._s(t.formatSelectValue(t.detail.defaultValue)))])]:t._e(),t._v(" "),"el-upload"===t.detail.tag?[i("van-cell",{attrs:{title:t.detail.label,"is-link":""},on:{click:function(e){return t.viewFile(t.detail.defaultValue)}}}),t._v(" "),i("file-view",{ref:"fileView"})]:t._e()],2)},[],!1,u,"data-v-48b99142",null).exports,d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},f={name:"DiyFormEdit",components:{FormItemView:p},mixins:[o],data:function(){return{dialogVisible:!1,formLayout:{fields:[]},loading:!1,applyId:"",applyData:{},modelForm:{},noDraft:!1,config:{}}},created:function(){},deactivated:function(){},methods:{getFormLayout:function(){return d({},this.formLayout)},open:function(t,e,i){var a=this;this.config=i||{};var o=!1;this.applyId=e||"",this.formLayout={fields:[]};var r=[this.$http.get("approval-village/AppBusinessController/findApprovalFormById",{id:t})];return e&&r.push(this.$http.get("approval-village/AppBusinessController/findDetailById",{id:e}).then(function(t){var e=t.data,i=e.approvalBusinessEntity||{},o=i.nextNodeCode||i.currentNodeCode;return o?a.$http.get("approval-village/AppBusinessController/findProcessNodeByNodeCode",{approvalProcessId:i.approvalProcessId,nodeCode:o}).then(function(i){return e.positionInfo=i.data||{},t}):t})),Promise.all(r).then(function(t){t[1]&&(1===(t[1].data||{}).isDraft&&(o=!0));return a.formLayout=a._formatLayout(t[0]&&t[0].data,t[1]&&t[1].data,"edit"),a.modelForm=a._createModelForm(a.formLayout.fields),a.applyData=t[1]&&t[1].data||{},a.noDraft=o,t}).then(function(t){var e=a.checkJump(t[0].data);return e?window.open(e):a.dialogVisible=!0,t})},checkJump:function(t){for(var e=t.approvalFormEntityList||[],i=0;i<e.length;i++){var a=e[i].moduleContext,o=JSON.parse(a);if(o.jump&&o.href)return o.href}return""},okHandler:function(){var t=this;this.$refs.jsxPreview.submitForm().then(function(e){t.sendServer(e).then(function(){t.loading=!1,t.dialogVisible=!1,t.$message.success("操作成功！"),t.$emit("ok")}).catch(function(e){console.log(e),t.loading=!1})})},saveDraft:function(){var t=this,e=this.$refs.jsxPreview.getFormData();this.sendServer(e,!0).then(function(){t.loading=!1,t.dialogVisible=!1,t.$message.success("操作成功！"),t.$emit("ok")}).catch(function(e){console.log(e),t.loading=!1})},submitHandler:function(){var t=this;this.$refs.jsxPreview.submitForm().then(function(e){t.sendServer(e).then(function(e){t.$emit("ok");var i=e.data;t.diyFormDialogSubmit({formInstanceId:i,formId:t.formLayout.phid}).finally(function(){t.loading=!1,t.dialogVisible=!1})}).catch(function(e){console.log(e),t.loading=!1})})},sendServer:function(t,e){var i=this._getApprovalFormModuleAddFormList(this.formLayout,t),a=i.approvalFormModuleAddFormList;"quickApply"===this.config.type&&(this.applyId="");var o="approval/AppBusinessController/add";this.applyId&&(o="approval/AppBusinessController/edit");var r={orgCode:this.$commonQueryParam.orgCode,orgId:this.$commonQueryParam.orgId,isDraft:!0===e?0:1,formId:this.formLayout.phid,formName:this.formLayout.formName,userName:this.$commonQueryParam.phCreator,applyUserId:this.$commonQueryParam.phUserId,phid:this.applyId,applyAmount:i.money,approvalProcessTypeId:"1",approvalFormModuleAddFormList:a};return"reApply"===this.config.type&&(o="approval/AppBusinessController/reAdd",r.oldInstanceId=this.applyId),this.loading=!0,this.$http.post(o,r)},diyFormDialogSubmit:function(t){return this.$refs.selectProcessDialog.selectCheck({formInstanceId:t.formInstanceId,formId:t.formId,approvalProcessTypeId:"1"})}}};var h=function(t){i("yDCc")},v=Object(c.a)(f,function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.dialogVisible?i("div",[i("van-form",t._l(t.formLayout.fields,function(e){return i("div",{key:e.renderKey},["rowFormItem"===e.layout?i("div",[e.children?i("div",[i("van-cell-group",{scopedSlots:t._u([{key:"title",fn:function(){return[i("div",{staticClass:"col-title"},[i("div",{staticClass:"col-title-content"},[t._v(t._s(e.label))])])]},proxy:!0}],null,!0)},[t._v(" "),t._l(e.children,function(e){return i("div",{key:e.renderKey},[i("form-item-view",{attrs:{detail:e,"model-form":t.modelForm}})],1)})],2)],1):t._e()]):i("div",[i("form-item-view",{attrs:{detail:e,"model-form":t.modelForm}})],1)])}),0)],1):t._e()},[],!1,h,"data-v-1098c819",null);e.a=v.exports},GMzt:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("FJTA"),o=i("cS0T"),r=i("tHn/"),n=i("XQm/"),s=i("mdH/"),l=i("j0Zy"),c=i("bSIt"),u=i("AyHE"),p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t};var d={name:"ApprovalDetail",components:{LockTag:a.a,Agree:o.a,ApprovalResult:s.a,ApprovalRejection:n.a,FileView:r.a,DiyFormView:u.a,ApprovalStepsCol:l.a},data:function(){return{valueList:[],searchForm:(e={approvalComments:2,approvalCommentsExplain:"",fileInfo:[{fileName:"",fileUrl:""}],phIdList:[],reject:0},t&&(e=Object.assign(e,t)),e),documentNo:this.$route.query.documentNo,phId:this.$route.query.phid,orgId:this.$route.query.orgId,busType:this.$route.query.busType,detail:[],accountList:[{}],fileList:[],agreeShow:!1,processNodeData:{}};var t,e},computed:p({},Object(c.b)(["userInfo"])),created:function(){},mounted:function(){var t=this;this.$refs.diyFormView.open(this.$route.query.formId,this.$route.query.formInstanceId).then(function(e){if(e[1]){var i=t.querySteps(e[1].data||{});if(i)return i}})},methods:{querySteps:function(t){var e=this,i=(t.approvalBusinessEntity||{}).phid||"";if(t.formStatus&&i)return this.$http.get("approval-village/AppBusinessController/findBusinessNodeMessage",{businessId:i}).then(function(t){e.processNodeData=t.data||{}})},SET_STATUS:function(t,e,i){return e===i-1&&2===t?"审批通过":this.$APPROVAL_NODE_STATUS[t].label},formatPreApprovalStatus:function(t){var e=this.$APPROVAL_NODE_STATUS[t.approvalStatus].label;return 1===t.approvalStatus&&this.userInfo.userName!==t.user.userName?"待他审批":e},queryDetail:function(){var t=this;this.loading=!0,this.current=this.current+1,this.$http.get("villageapp/SpApplyRecord/getApplyDetailByConditionNext",{documentNo:this.documentNo,phId:this.phId,orgId:this.orgId}).then(function(e){t.detail=e.data||{},t.accountList=e.data.accountList||[],t.fileList=e.data.fileList||[];var i=e.data.historyList||[];i.forEach(function(t){t.approverOrder||(t.approverOrder=0)}),t.valueList=i})},toAccount:function(){this.$refs.accountView.open(this.accountList)},viewFile:function(){var t=[];this.detail.fileList.forEach(function(e){t.push({name:e.fileName,url:e.fileUrl})}),this.$refs.fileView.open(t)},viewFileHis:function(t){var e=[];t.forEach(function(t){e.push({name:t.fileName,url:t.fileUrl})}),this.$refs.fileView.open(e)},backHandler:function(){this.$router.history.go(-1)}}},f=i("W5g0");var h=function(t){i("61cz")},v=Object(f.a)(d,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-cert-detail"},[i("van-nav-bar",{attrs:{"left-arrow":""},on:{"click-left":t.backHandler},scopedSlots:t._u([{key:"title",fn:function(){return[t.$route.query.theme&&t.$route.query.theme.length>11?i("div",{staticClass:"h-n-b"},[i("van-notice-bar",{attrs:{text:t.$route.query.theme,scrollable:""}})],1):i("div",[t._v(t._s(t.$route.query.theme))])]},proxy:!0}])}),t._v(" "),i("div",{staticClass:"cert-content"},[i("div",{staticClass:"diy-form-view-wrap"},[i("diy-form-view",{ref:"diyFormView"})],1),t._v(" "),i("div",{staticClass:"a-s-w"},[i("approval-steps-col",{attrs:{detail:t.processNodeData}})],1)]),t._v(" "),i("file-view",{ref:"fileView"})],1)},[],!1,h,"data-v-f5153788",null);e.default=v.exports},QQC1:function(t,e){},TahT:function(t,e){},"XQm/":function(t,e,i){"use strict";var a=i("FJTA"),o=i("A29K"),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t};function n(t){var e={operateMessage:"",userId:"",rejectNodeId:"",operateType:"3",files:[]};return t&&(e=Object.assign(e,t)),e}var s={name:"ApprovalRejection",components:{LockTag:a.a},data:function(){return{form:n(),rejectApply:[],fileList:[],fileInfo:[],approvalCommentsExplain:"",reject:"",phId:"",iconSize:.5*window.adaptive.fontSize+"px",show:!1,loading:!1,detail:{},lineWidth:6,lineColor:"#000000",bgColor:"",resultImg:"",isCrop:!1,processDetail:{}}},created:function(){},deactivated:function(){this.show=!1},methods:{open:function(t){this.approvalCommentsExplain="",this.form=n(),this.fileList=[],this.detail=t,this.queryProcess(),this.getRejectNode(),this.show=!0},queryProcess:function(){var t=this;return this.loading=!0,this.$http.get("approval-village/AppBusinessController/findProcessById",{id:this.$route.query.processId}).then(function(e){t.loading=!1,t.processDetail=e.data||{}}).catch(function(e){console.log(e),t.loading=!1})},close:function(){this.show=!1,this.$emit("close")},afterRead:function(t){this.uploadFile(t.file)},backHandler:function(){this.$router.history.go(-1)},getRejectNode:function(){var t=this;return this.$http.get("approval-village/AppBusinessController/findApprovalBusinessNodeList",{businessId:this.$route.query.phid}).then(function(e){var i=e.data;t.rejectApply=i})},uploadFile:function(t){var e=this;this.loading=!0;var i=new FormData;return i.append("file",t),i.append("type",8),this.$http.postFormData("ucenter/file/upload",i).then(function(t){if(t.data){var i=t.data;if(!(i.fileDwg&&i.fileSize&&i.url&&i.name))return void o.b.fail.error("上传失败!");e.form.files.push({name:i.name,url:i.url,fileDwg:i.fileDwg,fileSize:i.fileSize})}e.loading=!1}).catch(function(t){console.log(t),e.loading=!1})},rejectionSubmission:function(){if(-1!==this.processDetail.approvalOpinionRules.indexOf("3")&&!this.approvalCommentsExplain)return o.b.fail("请输入审批意见！"),!1;this.submit()},success:function(){this.show=!1,this.$emit("ok")},handleReset:function(){this.$refs.esign.reset()},submit:function(){var t=this,e=r({},this.form);e.userId=this.$commonQueryParam.phUserId,e.approvalUserId=this.$commonQueryParam.phUserId,e.approvalUserName=this.$commonQueryParam.phCreator,e.formInstanceId=this.$route.query.formInstanceId,e.processId=this.$route.query.processId,e.businessId=this.$route.query.phid,e.operateMessage=this.approvalCommentsExplain,e.rejectNodeId=this.reject;var i=[];e.files.forEach(function(t){i.push(t)}),this.loading=!0,this.$http.postFormData("approval-village/AppBusinessController/processAudit",r({},e,{orgId:this.$commonQueryParam.orgId,approvalBusinessFileList:i})).then(function(){t.loading=!1,t.success()}).catch(function(){t.loading=!1})},toPath:function(t){this.$router.push(t)}}},l=i("W5g0");var c=function(t){i("QQC1")},u=Object(l.a)(s,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-popup",{style:{height:"100%",width:"100%"},attrs:{position:"left"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("van-nav-bar",{attrs:{title:"审批退回","left-arrow":""},on:{"click-left":t.close}}),t._v(" "),i("div",{staticClass:"a-p"},[i("van-field",{staticStyle:{"box-shadow":"0 -4px 4px 4px #efefef"},attrs:{placeholder:t.processDetail.approvalOnTips||"请输入意见",autosize:"",rows:"1","label-width":"3em",type:"textarea"},model:{value:t.approvalCommentsExplain,callback:function(e){t.approvalCommentsExplain=e},expression:"approvalCommentsExplain"}}),t._v(" "),i("div",{staticClass:"top"},[i("div",{staticClass:"bigTitle"},[t._v("选择退回节点")]),t._v(" "),i("van-steps",{attrs:{active:t.rejectApply.length,direction:"vertical","inactive-icon":"checked","active-icon":"circle"}},[i("van-radio-group",{model:{value:t.reject,callback:function(e){t.reject=e},expression:"reject"}},t._l(t.rejectApply,function(e,a){return i("van-step",{key:a,staticClass:"steps"},[i("van-radio",{attrs:{name:e.phid,"icon-size":t.iconSize}},[t._v(t._s(e.nodeName))])],1)}),1)],1)],1),t._v(" "),i("div",{staticClass:"top"},[i("div",[t._v("附件")])]),t._v(" "),i("div",{staticClass:"up-b"},[i("van-uploader",{attrs:{"after-read":t.afterRead,multiple:""},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1),t._v(" "),i("div",{staticClass:"bottom-btn"},[i("van-button",{attrs:{loading:t.loading,type:"primary","loading-text":"图片上传中...",block:""},on:{click:function(e){return t.rejectionSubmission()}}},[t._v("退回")])],1)],1)],1)},[],!1,c,"data-v-18e24fb4",null);e.a=u.exports},cS0T:function(t,e,i){"use strict";var a=i("FJTA"),o=i("A29K"),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t};function n(t){var e={operateMessage:"",userId:"",rejectNodeId:"",operateType:"1",files:[],postUserList:[]};return t&&(e=Object.assign(e,t)),e}var s={name:"Completed",components:{LockTag:a.a},data:function(){return{form:n(),approvalCommentsExplain:"",fileList:[],show:!1,loading:!1,detail:{},lineWidth:6,lineColor:"#000000",bgColor:"",resultImg:"",isCrop:!1,processDetail:{},userList:[],signList:[]}},created:function(){},deactivated:function(){this.show=!1},methods:{open:function(t){this.approvalCommentsExplain="",this.form=n(),this.fileList=[],this.detail=t,this.queryProcess(),this.checkUser(),this.show=!0},checkUser:function(){var t=this;return this.$http.postFormData("approval-village/approvalBusiness/findNextNodePeoples",{processId:this.$route.query.processId,formInstanceId:this.$route.query.formInstanceId}).then(function(e){var i=e.data||{};t.userList=i.userList||[]})},queryProcess:function(){var t=this;return this.loading=!0,this.$http.get("approval-village/AppBusinessController/findProcessById",{id:this.$route.query.processId}).then(function(e){t.loading=!1,t.processDetail=e.data||{}}).catch(function(e){console.log(e),t.loading=!1})},afterRead:function(t){this.uploadFile(t.file)},uploadFile:function(t){var e=this;this.loading=!0;var i=new FormData;return i.append("file",t),i.append("type",8),this.$http.postFormData("ucenter/file/upload",i).then(function(t){if(t.data){var i=t.data;if(!(i.fileDwg&&i.fileSize&&i.url&&i.name))return void o.b.fail.error("上传失败!");e.form.files.push({name:i.name,url:i.url,fileDwg:i.fileDwg,fileSize:i.fileSize})}e.loading=!1}).catch(function(t){console.log(t),e.loading=!1})},agree:function(){return-1===this.processDetail.approvalOpinionRules.indexOf("1")||this.approvalCommentsExplain?this.userList.length&&this.form.postUserList.length<1?(o.b.fail("请选择选签人！"),!1):void this.submit():(o.b.fail("请输入审批意见！"),!1)},close:function(){this.show=!1,this.$emit("close")},success:function(){this.show=!1,this.$emit("ok")},handleReset:function(){this.$refs.esign.reset()},submit:function(){var t=this,e=r({},this.form);e.userId=this.$commonQueryParam.phUserId,e.approvalUserId=this.$commonQueryParam.phUserId,e.approvalUserName=this.$commonQueryParam.phCreator,e.formInstanceId=this.$route.query.formInstanceId,e.processId=this.$route.query.processId,e.businessId=this.$route.query.phid,e.operateMessage=this.approvalCommentsExplain;var i=[];e.files.forEach(function(t){i.push(t)});var a=[];this.userList.forEach(function(e){-1!==t.form.postUserList.indexOf(e.userId)&&a.push(e)}),e.postUserList=a,this.loading=!0,this.$http.postFormData("approval-village/AppBusinessController/proces11sAudit",r({},e,{orgId:this.$commonQueryParam.orgId,approvalBusinessFileList:i})).then(function(){t.loading=!1,t.success()}).catch(function(){t.loading=!1})},toPath:function(t){this.$router.push(t)}}},l=i("W5g0");var c=function(t){i("oBXS")},u=Object(l.a)(s,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-popup",{style:{height:"100%",width:"100%"},attrs:{position:"left"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("van-nav-bar",{attrs:{title:"审批同意","left-arrow":""},on:{"click-left":t.close}}),t._v(" "),i("div",{staticClass:"a-p"},[i("van-field",{staticStyle:{"box-shadow":"0 -4px 4px 4px #efefef"},attrs:{placeholder:t.processDetail.approvalOnTips||"请输入意见","label-width":"3em",rows:"6",type:"textarea"},model:{value:t.approvalCommentsExplain,callback:function(e){t.approvalCommentsExplain=e},expression:"approvalCommentsExplain"}}),t._v(" "),t.userList.length?i("div",[i("div",{staticClass:"top"},[i("div",{staticClass:"bigTitle"},[t._v("选择下一节点审批人")])]),t._v(" "),i("div",{staticClass:"u-s-w"},[i("van-checkbox-group",{model:{value:t.form.postUserList,callback:function(e){t.$set(t.form,"postUserList",e)},expression:"form.postUserList"}},t._l(t.userList,function(e){return i("div",{key:e.userId,staticClass:"u-s-i"},[i("van-checkbox",{attrs:{name:e.userId}},[t._v(t._s(e.userName))])],1)}),0)],1)]):t._e(),t._v(" "),i("div",{staticClass:"top"},[i("div",[t._v("附件")])]),t._v(" "),i("div",{staticClass:"up-b"},[i("van-uploader",{attrs:{"after-read":t.afterRead,multiple:""},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1),t._v(" "),i("div",{staticClass:"bottom-btn"},[i("van-button",{attrs:{loading:t.loading,type:"primary","loading-text":"图片上传中...",block:""},on:{click:function(e){return t.agree()}}},[t._v("同意")])],1)],1)],1)},[],!1,c,"data-v-36526aac",null);e.a=u.exports},j0Zy:function(t,e,i){"use strict";var a={0:{label:"待他人审批",value:0},1:{label:"待我审批",value:1},2:{label:"取消审批",value:2},3:{label:"审批通过",value:3},4:{label:"审批未通过",value:4},5:{label:"审批退回",value:5},6:{label:"审批退回(未送审)",value:6}},o={components:{FileView:i("tHn/").a},props:{detail:{type:Object,default:function(){return{approvalNodeOperateLogEntityList:[],isFinish:0}}},businessId:{type:String,default:""}},data:function(){return{active:1,STATUS:a,stepList:[],stepIsFinish:!1,formTemp:{}}},computed:{activeS:function(){var t=this.stepList.length;return this.stepIsFinish?t+1:t}},watch:{detail:function(){this.initData()}},created:function(){var t=this;this.businessId?this.$http.get("approval-village/AppBusinessController/findBusinessNodeMessage",{businessId:this.businessId}).then(function(e){var i=e.data||{};t.initData(i)}):this.initData()},methods:{initData:function(t){var e=this,i=[];((t=t||this.detail).approvalNodeOperateLogEntityList||[]).forEach(function(t){t.operateType=t.operateType||0,0===t.operateType&&t.approvalUsersName===e.$commonQueryParam.phCreator&&(t.operateType=1),i.push(t)}),this.stepList=i,this.stepIsFinish=1===t.isFinish},handleClickItem:function(t){var e=this;this.$http.get("ucenter/file/download",{filePath:t.fileUrl},{responseType:"arraybuffer"}).then(function(i){e.$downloadFile(i,t.fileName)}).catch(function(t){console.log("err",t)})},getDT:function(t){return t.approvalUsersName?a[t.operateType].label:1===t.signType?"或签":2===t.signType?"会签":"选签"},getShowUserName:function(t){var e=t.approvalPostHisEntity||{};if(t.approvalUsersName){var i="";return(i=1===t.signType?t.approvalUsersName:this.getPositionUserNames(t).join(","))||(i=e.postName),i}return e.postName},getPositionUserNames:function(t){return(t.userList||[]).map(function(t){return t.userName})},viewFileHis:function(t){var e=[];t.forEach(function(t){e.push({name:t.name,url:t.url})}),this.$refs.fileView.open(e)}}},r=i("W5g0");var n=function(t){i("jB4P")},s=Object(r.a)(o,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"com-approval-steps-col"},[i("van-steps",{attrs:{active:t.activeS,direction:"vertical","inactive-icon":"checked","active-icon":"circle"}},[t._l(t.stepList,function(e,a){return i("van-step",{key:a,attrs:{"active-icon":"","inactive-icon":""}},[i("div",{staticClass:"time",staticStyle:{display:"flex","justify-content":"space-between"}},[i("span",{staticClass:"sub-Bigtext"},[i("div",0===a?[t._v(t._s(e.phCreator)+"  发起审批")]:[(e.approvalUsersName,i("div",[t._v(t._s(t.getShowUserName(e))+"  "+t._s(t.getDT(e)))]))])]),t._v(" "),i("span",{staticClass:"sub-text"},[i("div",{staticClass:"color-black"},[t._v(t._s(e.phUpdateDt))])])]),t._v(" "),i("div",{staticClass:"content"},[0!==a?i("div",[e.operateLogEntityList&&e.operateLogEntityList.length?i("div",t._l(e.operateLogEntityList,function(e,a){return i("div",{key:a},[i("div",{staticClass:"v-item"},[i("span",{staticClass:"v-label b-tag"},[i("div",{staticClass:"b-t theme-bg"}),t._v("\n                  审批人：\n                ")]),t._v(" "),i("span",{staticClass:"v-text"},[t._v(t._s(e.approvalUserName))])]),t._v(" "),i("div",{staticClass:"v-item"},[i("span",{staticClass:"v-label"},[t._v("审批意见：")]),t._v(" "),i("span",{staticClass:"v-text"},[t._v(t._s(e.operateMessage))])]),t._v(" "),i("div",{staticClass:"v-item"},[i("span",{staticClass:"v-label"},[t._v("审批时间：")]),t._v(" "),i("span",{staticClass:"v-text"},[t._v(t._s(e.phInsertDt))])])])}),0):t._e(),t._v(" "),i("div",[e.fileList&&e.fileList.length?i("span",{staticClass:"look sub-look theme-text",on:{click:function(i){return t.viewFileHis(e.fileList)}}},[t._v("附件("+t._s(e.fileList.length)+")")]):t._e()])]):t._e()])])}),t._v(" "),t.stepIsFinish?i("van-step",{key:"ot",attrs:{"active-icon":"","inactive-icon":""}},[i("div",{staticClass:"time",staticStyle:{display:"flex","justify-content":"space-between"}},[i("span",{staticClass:"sub-Bigtext"},[i("div",[t._v("流程结束")])])])]):t._e()],2),t._v(" "),i("file-view",{ref:"fileView"})],1)},[],!1,n,"data-v-525ba678",null);e.a=s.exports},jB4P:function(t,e){},"mdH/":function(t,e,i){"use strict";var a=i("bSIt"),o=i("A29K"),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},n={name:"ApprovalResult",components:{},data:function(){return{show:!1,type:"agree"}},computed:r({},Object(a.b)(["preSearchForm"])),created:function(){},deactivated:function(){this.show=!1},methods:{open:function(t){this.type=t.type,this.show=!0},backHandler:function(){this.$router.history.go(-1)},toPath:function(t){this.$router.push(t)},queryNext:function(){this.queryList()},queryList:function(){var t=this;this.$http.get("villageapp/SpApprovalRecord/pendingMyApprovalNext",r({},this.preSearchForm,{current:1,size:1})).then(function(e){var i=(e.data||{}).records||[];i.length?(t.show=!1,t.$router.replace({name:"ApprovalDetail",query:{phid:i[0].phid,orgId:i[0].phCurorgid,documentNo:i[0].documentNo}})):Object(o.b)("已无待审批单据！")})}}},s=i("W5g0");var l=function(t){i("mtQ5")},c=Object(s.a)(n,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-popup",{style:{height:"100%",width:"100%"},attrs:{position:"left"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("van-nav-bar",{attrs:{title:"审批完成","left-arrow":""},on:{"click-left":t.backHandler}}),t._v(" "),"disagree"===t.type?i("div",{staticClass:"content"},[i("div",{staticClass:"tu"}),t._v(" "),i("p",[t._v("已不同意")])]):t._e(),t._v(" "),"agree"===t.type?i("div",{staticClass:"content"},[i("div",{staticClass:"tu"}),t._v(" "),i("p",[t._v("已同意")])]):t._e(),t._v(" "),"back"===t.type?i("div",{staticClass:"content"},[i("div",{staticClass:"tu"}),t._v(" "),i("p",[t._v("已退回")])]):t._e(),t._v(" "),i("div",{staticClass:"btn"},[i("van-button",{staticClass:"b-i",attrs:{block:""},on:{click:function(e){return t.backHandler()}}},[t._v("返回列表")])],1)],1)},[],!1,l,"data-v-79cde4a4",null);e.a=c.exports},mtQ5:function(t,e){},oBXS:function(t,e){},yDCc:function(t,e){}});