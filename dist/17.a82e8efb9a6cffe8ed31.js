webpackJsonp([17],{ByjX:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("zH3I"),o=i.n(s),a=i("wOqC"),r=i("Z5i5"),n=i("Rz25"),c=i("HRnp"),l=i("A29K"),h=i("bSIt"),m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t};var u={name:"IncomeExpendInfo",components:{YearMonthRangeSelect:a.a,BookSelect:r.a,ViewLoading:c.a,BetterPick:n.a},data:function(){return{searchForm:(e={date:"",isDelClose:1,isDelUnAudit:0,isIncomeQuery:0,isUsedSub:0,monthEnd:"",monthStart:"",orgName:"",subCode:"",userName:"",year:""},t&&(e=Object.assign(e,t)),e),oldSearchFrom:{},list:[],list1:[],isFirstTimes:!0,currentBook:{},show:!1,filterLoading:!1,viewLoading:!1,isIncomeQuery:0};var t,e},computed:m({dateRangeShowName:function(){return o()(this.searchForm.monthStart).format("YYYY年M月")+"-"+o()(this.searchForm.monthEnd).format("YYYY年M月")}},Object(h.b)(["userBookList","userInfo","orgInfo"])),created:function(){if(0===this.userBookList.length)return l.b.fail("用户无关联账本！"),this.$router.replace("/index/home"),!1;this.currentBook=this.userBookList[0],this.searchForm.monthStart=o()(this.currentBook.nowPeriod).format("YYYY-MM-DD"),this.searchForm.monthEnd=o()(this.currentBook.nowPeriod).format("YYYY-MM-DD"),"1"===this.$route.query.type&&(this.isIncomeQuery=1),this.queryList()},activated:function(){this.isFirstTimes||this.queryList(),this.isFirstTimes=!1},methods:{bookChange:function(t){this.currentBook=t,this.searchForm.monthStart=o()(this.currentBook.nowPeriod).format("YYYY-MM-DD"),this.searchForm.monthEnd=o()(this.currentBook.nowPeriod).format("YYYY-MM-DD"),this.queryList()},openFilter:function(){this.oldSearchFrom=this.$deepClone(this.searchForm),this.show=!0,this.filterLoading=!1},setOldSearchFrom:function(){this.searchForm.isDelUnAudit=0,this.searchForm.isDelClose=0},filterOK:function(){var t=this;this.filterLoading=!0,this.show=!1,this.queryList().then(function(){t.filterLoading=!1}).catch(function(e){console.log(e),t.filterLoading=!1})},openDateRangeSelect:function(){this.$refs.yearMonthRangeSelect.open([new Date(o()(this.searchForm.monthStart).format("YYYY/MM/DD")),new Date(o()(this.searchForm.monthEnd).format("YYYY/MM/DD"))])},dateRangeSelectOk:function(t){this.searchForm.monthStart=t[0],this.searchForm.monthEnd=t[1],this.queryList()},backHandler:function(){this.$router.history.go(-1)},queryList:function(){var t=this;return this.viewLoading=!0,this.$http.postFormData("villageapp/financialReport/financialReport",m({},this.searchForm,{bookId:this.currentBook.phid,monthStart:o()(this.searchForm.monthStart).format("M"),monthEnd:o()(this.searchForm.monthEnd).format("M"),year:o()(this.searchForm.monthStart).format("YYYY"),orgName:this.orgInfo.name,userName:this.userInfo.userName,date:o()().format("YYYY-MM-DD"),isIncomeQuery:this.isIncomeQuery})).then(function(e){t.viewLoading=!1;var i=e.data||{};t.list=i.records||[],t.list1=t.list[0]}).catch(function(e){console.log(e),t.viewLoading=!1})}}},d=i("W5g0");var f=function(t){i("t++d")},v=Object(d.a)(u,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-cert-list"},[i("van-nav-bar",{attrs:{title:"村级财务"+(t.isIncomeQuery?"支出":"收入")+"情况表","left-arrow":""},on:{"click-left":t.backHandler}}),t._v(" "),i("div",{staticClass:"s-w"},[i("div",{staticClass:"fake-input one"},[i("book-select",{attrs:{"current-book":t.currentBook},on:{change:t.bookChange}})],1),t._v(" "),i("div",{staticClass:"fake-input two",on:{click:t.openDateRangeSelect}},[i("div",{staticClass:"ellipsis-text"},[t._v(t._s(t.dateRangeShowName))])]),t._v(" "),i("div",{staticClass:"fake-input three",on:{click:t.openFilter}},[t._m(0)])]),t._v(" "),i("div",{staticClass:"view-loading-wrap"},[t.viewLoading?i("view-loading"):t._e(),t._v(" "),i("div",{staticClass:"c-l-w"},[i("van-row",{staticClass:"common-info-block",attrs:{type:"flex",justify:"space-between"}},[i("div",{staticClass:"ellipsis-text"},[t._v("本期总"+t._s(t.isIncomeQuery?"支出":"收入"))]),t._v(" "),i("div",{staticClass:"ellipsis-text"},[t._v(t._s(t.$formatMoney(t.list1.currentAmount)))])]),t._v(" "),i("div",{staticClass:"common-block"},[i("table",{staticClass:"app-table",attrs:{width:"100%",cellspacing:"0",cellpadding:"0",border:"2"}},[t._m(1),t._v(" "),t._l(t.list,function(e,s){return i("tr",{key:s},[i("td",{staticStyle:{"text-align":"center"}},[t._v(t._s(e.subName))]),t._v(" "),i("td",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.$formatMoney(e.currentAmount)))]),t._v(" "),i("td",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.$formatMoney(e.countAmount)))])])})],2)])],1)],1),t._v(" "),i("van-popup",{style:{height:"100%",width:"85%"},attrs:{position:"right"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("div",{staticClass:"f-w"},[i("div",[i("better-pick",{attrs:{"form-data":t.searchForm,columns:t.$SHI_FOU_SELECT,"value-key":"isDelUnAudit",title:"剔除未审核凭证"}},[i("van-cell",{attrs:{value:t.$SHI_FOU_LIST[t.searchForm.isDelUnAudit].label,title:"剔除未审核凭证","is-link":"","arrow-direction":"down"}})],1),t._v(" "),i("better-pick",{attrs:{"form-data":t.searchForm,columns:t.$SHI_FOU_SELECT,"value-key":"isDelClose",title:"剔除结转凭证"}},[i("van-cell",{attrs:{value:t.$SHI_FOU_LIST[t.searchForm.isDelClose].label,title:"剔除结转凭证","is-link":"","arrow-direction":"down"}})],1)],1),t._v(" "),i("div",{staticClass:"b-b-w"},[i("van-button",{staticClass:"b-b-i",attrs:{type:"default",size:"small"},on:{click:t.setOldSearchFrom}},[t._v("重置")]),t._v(" "),i("van-button",{staticClass:"b-b-i",attrs:{loading:t.filterLoading,type:"primary",size:"small"},on:{click:t.filterOK}},[t._v("确定")])],1)])]),t._v(" "),i("year-month-range-select",{ref:"yearMonthRangeSelect",attrs:{"same-year":!0,format:"YYYY-MM-DD"},on:{ok:t.dateRangeSelectOk}})],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("i",{staticClass:"iconfont icon-shaixuan"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",[this._v("项目")]),this._v(" "),e("th",[this._v("本期发生额")]),this._v(" "),e("th",[this._v("累计发生额")])])])}],!1,f,"data-v-dd68d4f8",null);e.default=v.exports},"t++d":function(t,e){}});